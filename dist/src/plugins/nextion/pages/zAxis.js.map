{"version":3,"sources":["../../../../../src/plugins/nextion/pages/zAxis.js"],"names":["require","_","ZAxis","screenManager","currentButton","setScreen","upTime","addListener","changePage","timeout","setTimeout","up","down","setBtn","nanoDLP","command","moveUp","moveDown","setup","getSetup","currentMm","status","CurrentHeight","MotorDegree","MicroStep","LeadscrewPitch","Math","floor","z","id","nextion","setValue","setText","abstract"],"mappings":"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","file":"zAxis.js","sourcesContent":["require(\"babel-polyfill\");\r\nimport abstract from \"./abstract.js\";\r\n\r\nlet _ = null;\r\n\r\nexport default class ZAxis extends abstract {\r\n\r\n\r\n    constructor(screenManager) {\r\n        super(screenManager);\r\n\r\n        this.currentButton = 8;\r\n    }\r\n\r\n    async init() {\r\n        await this.setScreen(\"zAxis\");\r\n        this.upTime = 0;\r\n\r\n        this.addListener(\"click_b17\", () => {\r\n            _ = this.changePage(\"settings\");\r\n        });\r\n        this.addListener(\"click_b16\", () => {\r\n            _ = this.changePage(\"home\");\r\n        });\r\n        this.addListener(\"click_b12\", () => {\r\n            if (this.currentButton === 7){\r\n                this.timeout = 100;\r\n            }else if (this.currentButton === 9){\r\n                this.timeout = 1000;\r\n            }else{\r\n                this.timeout = 3000;\r\n            }\r\n            if (this.upTime === 0){\r\n                setTimeout(() => {\r\n                    this.upTime = 0;\r\n                },this.timeout);\r\n                this.upTime = this.upTime + 1;\r\n                _ = this.up();\r\n            }\r\n        });\r\n        this.addListener(\"click_b13\", () => {\r\n            if (this.currentButton === 7){\r\n                this.timeout = 100;\r\n            }else if (this.currentButton === 9){\r\n                this.timeout = 1000;\r\n            }else{\r\n                this.timeout = 3000;\r\n            }\r\n            if (this.upTime === 0){\r\n                setTimeout(() => {\r\n                    this.upTime = 0;\r\n                },this.timeout);\r\n                this.upTime = this.upTime + 1;\r\n                _ = this.down();\r\n            }\r\n        });\r\n        this.addListener(\"click_b10\", () => this.setBtn(10));\r\n        this.addListener(\"click_b9\", () => this.setBtn(9));\r\n        this.addListener(\"click_b7\", () => this.setBtn(7));\r\n        this.addListener(\"click_b4\", () => this.nanoDLP.command(\"/z-axis/bottom\"));\r\n\r\n        _ = this.setBtn(10);\r\n    }\r\n\r\n    async up() {\r\n        _ = this.moveUp();\r\n    }\r\n\r\n    async down() {\r\n        _ = this.moveDown();\r\n    }\r\n\r\n    async moveDown() {\r\n        if (!this.setup) {\r\n            this.setup = await this.nanoDLP.getSetup();\r\n        }\r\n        let currentMm = this.status.CurrentHeight / ((360 / this.setup.MotorDegree * this.setup.MicroStep) / this.setup.LeadscrewPitch);\r\n        if (currentMm !== 0) {\r\n            switch (this.currentButton) {\r\n                case 11:\r\n                    if (currentMm > 100) {\r\n                        await this.nanoDLP.command(`/z-axis/move/down/micron/100000`);\r\n                    } else {\r\n                        this.nanoDLP.command(\"/z-axis/bottom\");\r\n                    }\r\n                    break;\r\n                case 10:\r\n                    if (currentMm > 10) {\r\n                        await this.nanoDLP.command(`/z-axis/move/down/micron/10000`);\r\n                    } else {\r\n                        this.nanoDLP.command(\"/z-axis/bottom\");\r\n                    }\r\n                    break;\r\n                case 9:\r\n                    if (currentMm > 1) {\r\n                        await this.nanoDLP.command(`/z-axis/move/down/micron/1000`);\r\n                    } else {\r\n                        this.nanoDLP.command(\"/z-axis/bottom\");\r\n                    }\r\n                    break;\r\n                case 8:\r\n                    if (currentMm > 0.5) {\r\n                        await this.nanoDLP.command(`/z-axis/move/down/micron/500`);\r\n                    } else {\r\n                        this.nanoDLP.command(\"/z-axis/bottom\");\r\n                    }\r\n                    break;\r\n                case 7:\r\n                    if (currentMm > 0.1) {\r\n                        await this.nanoDLP.command(`/z-axis/move/down/micron/100`);\r\n                    } else {\r\n                        this.nanoDLP.command(\"/z-axis/bottom\");\r\n                    }\r\n                    break;\r\n                case 6:\r\n                    await this.nanoDLP.command(`/z-axis/move/down/pulse/100`);\r\n                    break;\r\n                case 5:\r\n                    await this.nanoDLP.command(`/z-axis/move/down/pulse/10`);\r\n                    break;\r\n                case 2:\r\n                    await this.nanoDLP.command(`/z-axis/move/down/pulse/1`);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    async moveUp() {\r\n        if (!this.setup) {\r\n            this.setup = await this.nanoDLP.getSetup();\r\n        }\r\n        let currentMm = this.status.CurrentHeight / ((360 / this.setup.MotorDegree * this.setup.MicroStep) / this.setup.LeadscrewPitch);\r\n        currentMm = (currentMm < 0) ? 0 : Math.floor(currentMm * 10) / 10;\r\n        let z = (150 - currentMm) * 1000;\r\n        z = (z < 0) ? 0 : Math.floor(z * 10) / 10;\r\n        if (currentMm >= 150){\r\n            return;\r\n        }\r\n        switch (this.currentButton) {\r\n            case 11:\r\n                await this.nanoDLP.command(`/z-axis/move/up/micron/100000`);\r\n                break;\r\n            case 10:\r\n                if (currentMm > 140){\r\n                    await this.nanoDLP.command(\"/z-axis/move/up/micron/\" + z);\r\n                }else{\r\n                    await this.nanoDLP.command(`/z-axis/move/up/micron/10000`);\r\n                }\r\n                break;\r\n            case 9:\r\n                if (currentMm > 149){\r\n                    await this.nanoDLP.command(\"/z-axis/move/up/micron/\" + z);\r\n                }else{\r\n                    await this.nanoDLP.command(`/z-axis/move/up/micron/1000`);\r\n                }\r\n                break;\r\n            case 8:\r\n                await this.nanoDLP.command(`/z-axis/move/up/micron/500`);\r\n                break;\r\n            case 7:\r\n                await this.nanoDLP.command(`/z-axis/move/up/micron/100`);\r\n                break;\r\n            case 6:\r\n                await this.nanoDLP.command(`/z-axis/move/up/pulse/100`);\r\n                break;\r\n            case 5:\r\n                await this.nanoDLP.command(`/z-axis/move/up/pulse/10`);\r\n                break;\r\n            case 2:\r\n                await this.nanoDLP.command(`/z-axis/move/up/pulse/1`);\r\n                break;\r\n        }\r\n    }\r\n\r\n    async setBtn(id) {\r\n        await this.nextion.setValue(`bt${this.currentButton}`, 0);\r\n        this.currentButton = id;\r\n        await this.nextion.setValue(`bt${this.currentButton}`, 1);\r\n    }\r\n\r\n\r\n    async update(status) {\r\n        this.status = status;\r\n\r\n        if (!this.setup) {\r\n            this.setup = await this.nanoDLP.getSetup();\r\n        }\r\n\r\n        let currentMm = status.CurrentHeight / ((360 / this.setup.MotorDegree * this.setup.MicroStep) / this.setup.LeadscrewPitch);\r\n        currentMm = (currentMm < 0) ? 0 : Math.floor(currentMm * 10) / 10;\r\n        //currentMm = (currentMm < 0) ? 0 : ((currentMm > 150) ? 150 : Math.floor(currentMm * 10) / 10);\r\n        await this.setText(\"t1\", currentMm + \"mm\");\r\n    }\r\n}\r\n"]}