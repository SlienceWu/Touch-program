{"version":3,"sources":["../../../../../src/plugins/nextion/pages/config.js"],"names":["require","fs","_","Config","screenManager","selectedIdx","setScreen","profiles","nanoDLP","getProfiles","targetProfile","setText","Title","SupportLayerNumber","SupportCureTime","Depth","CureTime","addListener","length","indexChange","JSON","parse","readFileSync","nextion","getValue","writeFileSync","stringify","console","log","changePage","initProfiles","status","abstract"],"mappings":"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","file":"config.js","sourcesContent":["require(\"babel-polyfill\");\r\nconst fs = require(\"fs\");\r\n\r\nimport abstract from \"./abstract\";\r\n\r\nlet _ = null;\r\n\r\nexport default class Config extends abstract {\r\n\r\n    constructor(screenManager) {\r\n        super(screenManager);\r\n\r\n        this.selectedIdx = 0;\r\n    }\r\n\r\n    async init() {\r\n        await this.setScreen(\"config\");\r\n\r\n        if (!this.profiles) {\r\n            this.profiles = await this.nanoDLP.getProfiles();\r\n        }\r\n        let targetProfile = this.profiles[this.selectedIdx];\r\n\r\n        _ = this.setText(\"t1\", targetProfile.Title);\r\n        _ = this.setText(\"t2\", targetProfile.SupportLayerNumber);\r\n        _ = this.setText(\"t3\", targetProfile.SupportCureTime);\r\n        _ = this.setText(\"t4\", targetProfile.Depth);\r\n        _ = this.setText(\"t5\", targetProfile.CureTime);\r\n\r\n        this.addListener(\"click_b0\", async () => {\r\n            this.selectedIdx = (this.selectedIdx - 1 + this.profiles.length) % this.profiles.length;\r\n            this.indexChange();\r\n        });\r\n\r\n        this.addListener(\"click_b1\", async () => {\r\n            this.selectedIdx = (this.selectedIdx + 1) % this.profiles.length;\r\n            this.indexChange();\r\n        });\r\n\r\n        this.addListener(\"click_b2\", async () => {\r\n            let profiles = JSON.parse(fs.readFileSync(\"/home/pi/printer/db/profiles.json\"));\r\n            profiles[this.selectedIdx].SupportLayerNumber = await this.nextion.getValue(\"t2.r\");\r\n            profiles[this.selectedIdx].SupportCureTime = await this.nextion.getValue(\"t3.r\");\r\n            profiles[this.selectedIdx].CureTime = await this.nextion.getValue(\"t5.r\");\r\n            fs.writeFileSync(\"/home/pi/printer/db/profiles.json\", JSON.stringify(profiles));\r\n            console.log(\"Save profile -- SupportLayerNumber: \" + profiles[this.selectedIdx].SupportLayerNumber + \", SupportCureTime: \" + profiles[this.selectedIdx].SupportCureTime + \", CureTime: \" + profiles[this.selectedIdx].CureTime);\r\n        });\r\n\r\n        this.addListener(\"click_b3\", async () => {\r\n            this.changePage(\"home\");\r\n        });\r\n\r\n        this.addListener(\"click_b4\", async () => {\r\n            this.changePage(\"settings\");\r\n        });\r\n\r\n        this.addListener(\"click_b5\", async () => {\r\n            let initProfiles = JSON.parse(fs.readFileSync(\"/home/pi/printer/db/initProfiles.json\"));\r\n            _ = this.setText(\"t2\", initProfiles[this.selectedIdx].SupportLayerNumber);\r\n            _ = this.setText(\"t3\", initProfiles[this.selectedIdx].SupportCureTime);\r\n            _ = this.setText(\"t5\", initProfiles[this.selectedIdx].CureTime);\r\n\r\n            let profiles = JSON.parse(fs.readFileSync(\"/home/pi/printer/db/profiles.json\"));\r\n            profiles[this.selectedIdx].SupportLayerNumber = await this.nextion.getValue(\"t2.r\");\r\n            profiles[this.selectedIdx].SupportCureTime = await this.nextion.getValue(\"t3.r\");\r\n            profiles[this.selectedIdx].CureTime = await this.nextion.getValue(\"t5.r\");\r\n            fs.writeFileSync(\"/home/pi/printer/db/profiles.json\", JSON.stringify(profiles));\r\n        });\r\n    }\r\n\r\n    async indexChange(){\r\n        this.profiles = await this.nanoDLP.getProfiles();\r\n\r\n        let targetProfile = this.profiles[this.selectedIdx];\r\n\r\n        _ = this.setText(\"t1\", targetProfile.Title);\r\n        _ = this.setText(\"t2\", targetProfile.SupportLayerNumber);\r\n        _ = this.setText(\"t3\", targetProfile.SupportCureTime);\r\n        _ = this.setText(\"t4\", targetProfile.Depth);\r\n        _ = this.setText(\"t5\", targetProfile.CureTime);\r\n    }\r\n    async update(status) {\r\n        /*this.profiles = await this.nanoDLP.getProfiles();\r\n\r\n        let targetProfile = this.profiles[this.selectedIdx];\r\n\r\n        _ = this.setText(\"t1\", targetProfile.Title);\r\n        _ = this.setText(\"t2\", targetProfile.SupportLayerNumber);\r\n        _ = this.setText(\"t3\", targetProfile.SupportCureTime);\r\n        _ = this.setText(\"t4\", targetProfile.Depth);\r\n        _ = this.setText(\"t5\", targetProfile.CureTime);*/\r\n    }\r\n}"]}