{"version":3,"sources":["../../../../../src/plugins/nextion/pages/confirm.js"],"names":["require","_","Confirm","screenManager","options","setScreen","setText","text","disk","nanoDLP","getIndex","diskFree","stat","DiskFree","console","log","addListener","confirmType","deleteJson","plateID","changePage","confirmResult","data0","data1","data2","data3","returnPage","fs","readFile","err","data","error","plate","toString","JSON","parse","i","length","PlateID","splice","total","str","stringify","writeFile","abstract"],"mappings":"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","file":"confirm.js","sourcesContent":["import request from \"request-promise-native\";\r\n\r\nrequire(\"babel-polyfill\");\r\nimport abstract from \"./abstract.js\";\r\nimport fs from \"fs\";\r\n\r\nlet _ = null;\r\n\r\nexport default class Confirm extends abstract {\r\n\r\n    constructor(screenManager) {\r\n        super(screenManager);\r\n    }\r\n\r\n    async init(options) {\r\n        await this.setScreen(\"confirm\");\r\n        await this.setText(\"t0\", options.text);\r\n\r\n        let disk = 3000;\r\n        try{\r\n            let diskFree = await this.nanoDLP.getIndex();\r\n            if (diskFree.stat.DiskFree){\r\n                disk = diskFree.stat.DiskFree;\r\n                console.log(\"diskfree: \" + disk);\r\n            }\r\n        }catch (e) {\r\n            console.log(\"diskfree: \" + e);\r\n        }\r\n\r\n        this.addListener(\"click_b1\", () => {\r\n            if ( options.confirmType === \"deleteplate\"){\r\n                this.deleteJson(options.plateID);\r\n            }\r\n            if (disk < 500 && options.confirmType === \"addplate\"){\r\n                _ = this.changePage(\"rom\",{\r\n                    \"diskFree\": disk,\r\n                    confirmType: options.confirmType,\r\n                    confirmResult: false,\r\n                    data0: options.data0,\r\n                    data1: options.data1,\r\n                    data2: options.data2,\r\n                    data3: options.data3\r\n                });\r\n            }else{\r\n                if (options.confirmType === \"addplate\"){\r\n                    _ = this.changePage(\"bar\", {\r\n                        confirmType: options.confirmType,\r\n                        confirmResult: true,\r\n                        data0: options.data0,\r\n                        data1: options.data1,\r\n                        data2: options.data2,\r\n                        data3: options.data3\r\n                    });\r\n                }else{\r\n                    _ = this.changePage(options.returnPage, {\r\n                        confirmType: options.confirmType,\r\n                        confirmResult: true,\r\n                        data0: options.data0,\r\n                        data1: options.data1,\r\n                        data2: options.data2,\r\n                        data3: options.data3\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        this.addListener(\"click_b2\", () => {\r\n            if (options.data1 === \"stopSlice\"){\r\n                _ = this.changePage(\"slice\",options.data2);\r\n                return;\r\n            }\r\n            _ = this.changePage(options.returnPage, {\r\n                confirmType: options.confirmType,\r\n                confirmResult: false,\r\n                data0: options.data0,\r\n                data1: options.data1,\r\n                data2: options.data2,\r\n                data3: options.data3\r\n            });\r\n        });\r\n    }\r\n\r\n    async deleteJson(plateID){\r\n        fs.readFile(`/home/pi/nextion/bin/plugins/nextion/pages/setmodel.json`,async function(err,data){\r\n            if(err){\r\n                return console.error(error);\r\n            }\r\n            let plate = data.toString();\r\n            plate = JSON.parse(plate);\r\n            for(let i = 0; i < plate.data.length;i++) {\r\n                if (plateID == plate.data[i].PlateID){\r\n                    plate.data.splice(i,1);\r\n                }\r\n            }\r\n            plate.total = plate.data.length;\r\n            let str = JSON.stringify(plate);\r\n            fs.writeFile(`/home/pi/nextion/bin/plugins/nextion/pages/setmodel.json`,str,async function(err){\r\n                if(err){\r\n                    console.error(err);\r\n                }\r\n                console.log('----------删除成功-------------');\r\n            })\r\n        })\r\n    }\r\n}\r\n"]}