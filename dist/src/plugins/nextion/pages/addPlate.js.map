{"version":3,"sources":["../../../../../src/plugins/nextion/pages/addPlate.js"],"names":["require","fs","path","_","Home","screenManager","options","setScreen","nanoDLP","getProfiles","profiles","config","gconfig","plugins","plates","pconfig","showPage","pageFirstIdx","showFileFirstIdx","console","log","selectedIdx","ProfileID","Title","setText","confirmResult","confirmType","profileId","data0","devicePath","data1","targetFile","data2","fullPath","existsSync","statSync","isFile","changePage","buffer","readFileSync","uri","global","SERVER_URL","formData","value","filename","method","data3","addListener","devicePaths","availableFiles","drivelist","list","lista","forEach","drive","undefined","mountpoints","push","length","autoFetch","showAll","deviceFiles","j","tempPath","readdirSync","map","completePath","filter","filterFile","concat","current_page","page_count","Math","ceil","JSON","parse","writeFileSync","stringify","targetPath","dirname","basename","text","returnPage","fileIdx","files","exts","fileExt","split","i","extname","substr","toLowerCase","file","checkFile","abstract"],"mappings":"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","file":"addPlate.js","sourcesContent":["require(\"babel-polyfill\");\nconst fs = require(\"fs\");\nconst path = require(\"path\");\nimport abstract from \"./abstract.js\";\nimport request from \"request-promise-native\";\nimport gconfig from \"../../../../config.json\";\n\nlet _ = null;\n\nexport default class Home extends abstract {\n\n\n    constructor(screenManager) {\n        super(screenManager);\n    }\n\n    async init(options) {\n        await this.setScreen(\"addPlate\");\n        this.profiles = await this.nanoDLP.getProfiles();\n        this.config = gconfig.plugins.plates;\n        this.pconfig = gconfig.plugins.profiles;\n\n        let showPage = 1;\n        let pageFirstIdx = 0;\n        let showFileFirstIdx = 0;\n\n        console.log(\"Selected Profile ID:\" + this.profiles[this.pconfig.selectedIdx].ProfileID + \", Name: \" + this.profiles[this.pconfig.selectedIdx].Title);\n        await this.setText(\"t3\", this.profiles[this.pconfig.selectedIdx].ProfileID + \": \" + this.profiles[this.pconfig.selectedIdx].Title);\n\n        if (options) {\n            if (options.confirmResult && options.confirmType === \"addplate\") {\n                let profileId = options.data0;\n                let devicePath = options.data1;\n                let targetFile = options.data2;\n\n                let fullPath = devicePath + '/' + targetFile;\n                if (!(fs.existsSync(fullPath) && fs.statSync(fullPath).isFile())) {\n                    return this.changePage(\"plates\");\n                }\n                let buffer = fs.readFileSync(fullPath);\n\n                _ = request({\n                    uri: global.SERVER_URL + \"/plate/add\",\n                    formData: {\n                        'ZipFile': {\n                            value: buffer,\n                            options: {\n                                filename: targetFile\n                            }\n                        },\n                        'Path': targetFile,\n                        'ProfileID': profileId\n                    },\n                    method: 'POST'\n                });\n                return this.changePage(\"plates\");\n            } else if (!options.confirmResult && options.confirmType === \"addplate\") {\n                showPage = options.data3;\n                showFileFirstIdx = (options.data3 - 1) * 4;\n                pageFirstIdx = showFileFirstIdx;\n            }\n        }\n\n        this.addListener(\"click_b1\", () => {\n            _ = this.changePage(\"home\");\n        });\n        this.addListener(\"click_b2\", () => {\n            _ = this.changePage(\"plates\");\n        });\n\n        let devicePaths = [];\n        let availableFiles = [];\n\n        const drivelist = require('drivelist');\n        let lista = await drivelist.list();\n        lista.forEach((drive) => {\n            if (drive !== undefined && drive.mountpoints[0] !== undefined) {\n                devicePaths.push(drive.mountpoints[0].path);\n            }\n        });\n        console.log(\"Device count: \" + devicePaths.length);\n        if (this.config.autoFetch === \"true\" && this.config.showAll === \"false\" && availableFiles.length === 0) {\n            let deviceFiles = [];\n            for (let j = 0; j < devicePaths.length; ++j) {\n                this.tempPath = devicePaths[j];\n                deviceFiles = fs.readdirSync(this.tempPath);\n                deviceFiles = deviceFiles.map(this.completePath, this);\n                deviceFiles = deviceFiles.filter(this.filterFile, this);\n                console.log(\"Device\" + (j + 1) + \" -- Path: \" + devicePaths[j] + \", Available file count: \" + deviceFiles.length);\n                availableFiles = availableFiles.concat(deviceFiles);\n            }\n        }\n\n        this.current_page = showPage;\n        this.page_count = Math.ceil(availableFiles.length / 4.0);\n        _ = this.list(showFileFirstIdx, availableFiles);\n        _ = this.setText(\"t13\", this.current_page + '/' + this.page_count);\n\n        /*await drivelist.list((error, drives) => {\n            if (error) {\n                throw error;\n            }\n            drives.forEach((drive) => {\n                if (drive !== undefined && drive.mountpoints[0] !== undefined) {\n                    devicePaths.push(drive.mountpoints[0].path);\n                }\n            });\n            console.log(\"Device count: \" + devicePaths.length);\n\n            if (this.config.autoFetch === \"true\" && this.config.showAll === \"false\" && availableFiles.length === 0) {\n                let deviceFiles = [];\n                for (let j = 0; j < devicePaths.length; ++j) {\n                    this.tempPath = devicePaths[j];\n                    deviceFiles = fs.readdirSync(this.tempPath);\n                    deviceFiles = deviceFiles.map(this.completePath, this);\n                    deviceFiles = deviceFiles.filter(this.filterFile, this);\n                    console.log(\"Device\" + (j + 1) + \" -- Path: \" + devicePaths[j] + \", Available file count: \" + deviceFiles.length);\n                    availableFiles = availableFiles.concat(deviceFiles);\n                }\n            }\n\n            this.current_page = showPage;\n            this.page_count = Math.ceil(availableFiles.length / 4.0);\n            _ = this.list(showFileFirstIdx, availableFiles);\n            _ = this.setText(\"t13\", this.current_page + '/' + this.page_count);\n        });*/\n\n        this.addListener(\"click_b14\", () => {\n            this.current_page = ((this.current_page - 2 + this.page_count) % this.page_count) + 1;\n            pageFirstIdx = (this.current_page - 1) * 4;\n            _ = this.list(pageFirstIdx, availableFiles);\n            _ = this.setText(\"t13\", this.current_page + '/' + this.page_count);\n\n        });\n\n        this.addListener(\"click_b15\", () => {\n            this.current_page = (this.current_page % this.page_count) + 1;\n            pageFirstIdx = (this.current_page - 1) * 4;\n            _ = this.list(pageFirstIdx, availableFiles);\n            _ = this.setText(\"t13\", this.current_page + '/' + this.page_count);\n        });\n\n        this.addListener(\"click_b4\", async () => {\n            this.pconfig = gconfig.plugins.profiles;\n            this.pconfig.selectedIdx = (this.pconfig.selectedIdx - 1 + this.profiles.length) % this.profiles.length;\n            let config = JSON.parse(fs.readFileSync(\"/home/pi/nextion/config.json\"));\n            config.plugins.profiles.selectedIdx = this.pconfig.selectedIdx;\n            fs.writeFileSync(\"/home/pi/nextion/config.json\", JSON.stringify(config));\n            await this.setText(\"t3\", this.profiles[this.pconfig.selectedIdx].ProfileID + \": \" + this.profiles[this.pconfig.selectedIdx].Title);\n            console.log(\"Selected Profile -- ID: \" + this.profiles[this.pconfig.selectedIdx].ProfileID + \", Name: \" + this.profiles[this.pconfig.selectedIdx].Title);\n        });\n\n        this.addListener(\"click_b5\", async () => {\n            this.pconfig = gconfig.plugins.profiles;\n            this.pconfig.selectedIdx = (this.pconfig.selectedIdx + 1) % this.profiles.length;\n            let config = JSON.parse(fs.readFileSync(\"/home/pi/nextion/config.json\"));\n            config.plugins.profiles.selectedIdx = this.pconfig.selectedIdx;\n            fs.writeFileSync(\"/home/pi/nextion/config.json\", JSON.stringify(config));\n            await this.setText(\"t3\", this.profiles[this.pconfig.selectedIdx].ProfileID + \": \" + this.profiles[this.pconfig.selectedIdx].Title);\n            console.log(\"Selected Profile -- ID :\" + this.profiles[this.pconfig.selectedIdx].ProfileID + \", Name: \" + this.profiles[this.pconfig.selectedIdx].Title);\n        });\n\n        this.addListener(\"click_b9\", () => {\n            if (pageFirstIdx < availableFiles.length) {\n                let targetPath = path.dirname(availableFiles[pageFirstIdx]);\n                let targetFile = path.basename(availableFiles[pageFirstIdx]);\n                _ = this.changePage(\"confirm\", {\n                    text: \"addplate Profile:\" + this.profiles[this.pconfig.selectedIdx].Title + \";Path:\" + targetPath + \";File:\" + targetFile,\n                    confirmType: \"addplate\",\n                    returnPage: \"addPlate\",\n                    data0: this.profiles[this.pconfig.selectedIdx].ProfileID,\n                    data1: targetPath,\n                    data2: targetFile,\n                    data3: this.current_page\n                });\n            }\n        });\n\n        this.addListener(\"click_b10\", () => {\n            if ((pageFirstIdx + 1) < availableFiles.length) {\n                let targetPath = path.dirname(availableFiles[pageFirstIdx + 1]);\n                let targetFile = path.basename(availableFiles[pageFirstIdx + 1]);\n                _ = this.changePage(\"confirm\", {\n                    text: \"addplate Profile:\" + this.profiles[this.pconfig.selectedIdx].Title + \";Path:\" + targetPath + \";File:\" + targetFile,\n                    confirmType: \"addplate\",\n                    returnPage: \"addPlate\",\n                    data0: this.profiles[this.pconfig.selectedIdx].ProfileID,\n                    data1: targetPath,\n                    data2: targetFile,\n                    data3: this.current_page\n                });\n            }\n        });\n\n        this.addListener(\"click_b11\", () => {\n            if ((pageFirstIdx + 2) < availableFiles.length) {\n                let targetPath = path.dirname(availableFiles[pageFirstIdx + 2]);\n                let targetFile = path.basename(availableFiles[pageFirstIdx + 2]);\n                _ = this.changePage(\"confirm\", {\n                    text: \"addplate Profile:\" + this.profiles[this.pconfig.selectedIdx].Title + \";Path:\" + targetPath + \";File:\" + targetFile,\n                    confirmType: \"addplate\",\n                    returnPage: \"addPlate\",\n                    data0: this.profiles[this.pconfig.selectedIdx].ProfileID,\n                    data1: targetPath,\n                    data2: targetFile,\n                    data3: this.current_page\n                });\n            }\n        });\n\n        this.addListener(\"click_b12\", () => {\n            if ((pageFirstIdx + 3) < availableFiles.length) {\n                let targetPath = path.dirname(availableFiles[pageFirstIdx + 3]);\n                let targetFile = path.basename(availableFiles[pageFirstIdx + 3]);\n                _ = this.changePage(\"confirm\", {\n                    text: \"addplate Profile:\" + this.profiles[this.pconfig.selectedIdx].Title + \";Path:\" + targetPath + \";File:\" + targetFile,\n                    confirmType: \"addplate\",\n                    returnPage: \"addPlate\",\n                    data0: this.profiles[this.pconfig.selectedIdx].ProfileID,\n                    data1: targetPath,\n                    data2: targetFile,\n                    data3: this.current_page\n                });\n            }\n        });\n\n    }\n\n    async list(fileIdx, files) {\n        _ = this.setText(\"b9\", files.length > fileIdx ? (fileIdx + 1) + '. ' + path.basename(files[fileIdx]) : \"\");\n        _ = this.setText(\"b10\", files.length > fileIdx + 1 ? (fileIdx + 2) + '. ' + path.basename(files[fileIdx + 1]) : \"\");\n        _ = this.setText(\"b11\", files.length > fileIdx + 2 ? (fileIdx + 3) + '. ' + path.basename(files[fileIdx + 2]) : \"\");\n        _ = this.setText(\"b12\", files.length > fileIdx + 3 ? (fileIdx + 4) + '. ' + path.basename(files[fileIdx + 3]) : \"\");\n    }\n\n    checkFile(filename) {\n        let exts = this.config.fileExt.split(\"|\");\n\n        for (let i = 0; i < exts.length; ++i) {\n            if (path.extname(filename).substr(1).toLowerCase() === exts[i].toLowerCase()) {\n                return true;\n            }\n        }\n        return false;\n\n    }\n\n    filterFile(file) {\n        return this.checkFile(file) || this.config.showAll === \"true\";\n    }\n\n    completePath(file) {\n        return this.tempPath + '/' + file;\n    }\n}\n"]}