{"version":3,"sources":["../../../src/plugins/nextion.js"],"names":["require","Confirm","manager","isPrinting","nextion","NextionService","config","plugins","on","init","catch","console","error","e","currentPageId","connect","update","status","log","clearTimeout","updateTimeOut","Printing","setPage","currentPage","page","options","PageClass","default","dispose","Promise","resolve","setTimeout","abstract"],"mappings":"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","file":"nextion.js","sourcesContent":["require(\"babel-polyfill\");\r\nimport abstract from \"./abstract.js\";\r\n\r\nimport NextionService from \"./nextion/nextionService.js\";\r\n\r\nexport default class Confirm extends abstract {\r\n    constructor(manager) {\r\n        super(manager);\r\n\r\n        this.isPrinting = null;\r\n\r\n        this.nextion = new NextionService(this.config.plugins.nextion);\r\n\r\n        this.nextion.on(\"disconnect\", () => {\r\n            this.init().catch(e => console.error(e));\r\n        });\r\n    }\r\n\r\n    async init() {\r\n        this.isPrinting = null;\r\n        this.currentPageId = null;\r\n\r\n        await this.nextion.connect();\r\n\r\n        this.update(this.status, this.log).catch(e => console.error(e));\r\n    }\r\n\r\n    async update(status, log) {\r\n        if (!status)\r\n            return;\r\n\r\n        this.status = status;\r\n        this.log = log;\r\n\r\n        clearTimeout(this.updateTimeOut);\r\n\r\n        if (status.Printing !== this.isPrinting) {\r\n            this.isPrinting = status.Printing;\r\n            if (this.isPrinting){\r\n                await this.setPage(\"printingHome\");\r\n            }else{\r\n                await this.setPage(\"home\");\r\n            }\r\n        }\r\n        this.isPrinting = status.Printing;\r\n\r\n        await this.currentPage.update(status, log).catch((e) => console.error(e));\r\n    }\r\n\r\n    async setPage(page, options) {\r\n\r\n        switch (page) {\r\n            /*case \"home\":\r\n                if (this.isPrinting) {\r\n                    page = \"printingHome\";\r\n                    console.log(\"Printing task is running, initialize 'Page PrintingHome' first\");\r\n                } else {\r\n                    page = \"home\";\r\n                    console.log(\"Initialize 'Page Home'\");\r\n                }\r\n                break;*/\r\n            case \"addPlate\":\r\n                if (this.isPrinting) {\r\n                    page = \"nooperation\";\r\n                    options = \"plates\";\r\n                    console.log(\"Printing task is running, initialize 'Page PrintingHome' first\");\r\n                } else {\r\n                    page = \"addPlate\";\r\n                    console.log(\"Initialize 'Page addPlate'\");\r\n                }\r\n                break;\r\n            case \"plate\":\r\n                if (this.isPrinting) {\r\n                    page = \"nooperation\";\r\n                    options = \"plates\";\r\n                    console.log(\"Printing task is running, initialize 'Page PrintingHome' first\");\r\n                } else {\r\n                    page = \"plate\";\r\n                    console.log(\"Initialize 'Page plate'\");\r\n                }\r\n                break;\r\n            case \"setmodel\":\r\n                if (this.isPrinting) {\r\n                    page = \"nooperation\";\r\n                    options = \"plates\";\r\n                    console.log(\"Printing task is running, initialize 'Page PrintingHome' first\");\r\n                } else {\r\n                    page = \"setmodel\";\r\n                    console.log(\"Initialize 'Page setmodel'\");\r\n                }\r\n                break;\r\n            case \"zAxis\":\r\n                if (this.isPrinting) {\r\n                    page = \"nooperation\";\r\n                    options = \"settings\";\r\n                    console.log(\"Printing task is running, initialize 'Page PrintingHome' first\");\r\n                } else {\r\n                    page = \"zAxis\";\r\n                    console.log(\"Initialize 'Page zAxis'\");\r\n                }\r\n                break;\r\n            case \"projector\":\r\n                if (this.isPrinting) {\r\n                    page = \"nooperation\";\r\n                    options = \"settings\";\r\n                    console.log(\"Printing task is running, initialize 'Page PrintingHome' first\");\r\n                } else {\r\n                    page = \"projector\";\r\n                    console.log(\"Initialize 'Page projector'\");\r\n                }\r\n                break;\r\n            case \"config\":\r\n                if (this.isPrinting) {\r\n                    page = \"nooperation\";\r\n                    options = \"settings\";\r\n                    console.log(\"Printing task is running, initialize 'Page PrintingHome' first\");\r\n                } else {\r\n                    page = \"config\";\r\n                    console.log(\"Initialize 'Page config'\");\r\n                }\r\n                break;\r\n            case \"printingHome\":\r\n                if (options === \"back\"){\r\n                    if (this.isPrinting){\r\n                        page = \"printingHome\";\r\n                        console.log(\"Printing task is running, initialize 'Page PrintingHome' first\");\r\n                    }else{\r\n                        page = \"home\";\r\n                        console.log(\"Initialize 'Page home'\");\r\n                    }\r\n                }else{\r\n                    page = \"printingHome\";\r\n                    console.log(\"Initialize 'Page printingHome'\");\r\n                }\r\n                break;\r\n        }\r\n\r\n        if (this.currentPageId === page)\r\n            return;\r\n\r\n        let PageClass = null;\r\n        try {\r\n            PageClass = require(`./nextion/pages/${page}.js`).default;\r\n            console.log(\"Load 'Pageclass \" + page + \"'\");\r\n        } catch (e) {\r\n            return;\r\n        }\r\n\r\n        if (this.currentPage) {\r\n            try {\r\n                this.currentPage.dispose();\r\n            } catch (e) {\r\n                console.error(e);\r\n            }\r\n        }\r\n\r\n        this.currentPageId = page;\r\n        this.currentPage = new PageClass(this);\r\n\r\n        await new Promise((resolve) => setTimeout(resolve, 100));\r\n        this.currentPage.init(options).catch(e => console.error(e));\r\n\r\n        await this.update(this.status, this.log);\r\n    }\r\n}\r\n"]}